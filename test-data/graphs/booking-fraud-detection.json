{
  "tests": [
    {
      "input": {
        "booking": {
          "payment_method": "prepaid_card",
          "amount": 2500,
          "ip_country": "US"
        },
        "account": {
          "country": "US",
          "bookings_last_24h": 6
        }
      },
      "output": {
        "flags": {
          "manual_review": true,
          "requires_verification": true
        }
      }
    }
  ],
  "nodes": [
    {
      "type": "inputNode",
      "content": {
        "schema": ""
      },
      "id": "ip1",
      "name": "request",
      "position": {
        "x": 110,
        "y": 114
      }
    },
    {
      "type": "decisionTableNode",
      "content": {
        "hitPolicy": "first",
        "rules": [
          {
            "_id": "r1-1",
            "i1-1": "'prepaid_card'",
            "i1-2": "> 2000",
            "o1-1": "40",
            "o1-2": "'High-value prepaid card transaction'"
          },
          {
            "_id": "r1-2",
            "i1-1": "'prepaid_card'",
            "i1-2": "",
            "o1-1": "20",
            "o1-2": "'Prepaid card transaction'"
          },
          {
            "_id": "r1-3",
            "i1-1": "'gift_card'",
            "i1-2": "> 1000",
            "o1-1": "30",
            "o1-2": "'High-value gift card transaction'"
          },
          {
            "_id": "r1-4",
            "i1-1": "'gift_card'",
            "i1-2": "",
            "o1-1": "15",
            "o1-2": "'Gift card transaction'"
          },
          {
            "_id": "r1-5",
            "i1-1": "'cryptocurrency'",
            "i1-2": "",
            "o1-1": "25",
            "o1-2": "'Cryptocurrency transaction'"
          },
          {
            "_id": "r1-6",
            "i1-1": "'credit_card'",
            "i1-2": "> 3000",
            "o1-1": "15",
            "o1-2": "'High-value credit card transaction'"
          },
          {
            "_id": "r1-7",
            "i1-1": "",
            "i1-2": "",
            "o1-1": "0",
            "o1-2": "'Standard transaction'"
          }
        ],
        "inputs": [
          {
            "id": "i1-1",
            "name": "Payment Method",
            "field": "booking.payment_method"
          },
          {
            "id": "i1-2",
            "name": "Transaction Amount",
            "field": "booking.amount"
          }
        ],
        "outputs": [
          {
            "id": "o1-1",
            "name": "Payment Risk Score",
            "field": "risk.payment.score"
          },
          {
            "id": "o1-2",
            "name": "Payment Risk Reason",
            "field": "risk.payment.reason"
          }
        ],
        "passThrough": true,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single",
        "passThorough": false
      },
      "id": "dt1",
      "name": "payment_risk",
      "position": {
        "x": 430,
        "y": 16
      }
    },
    {
      "type": "decisionTableNode",
      "content": {
        "hitPolicy": "first",
        "rules": [
          {
            "_id": "r2-1",
            "i2-1": "> 5",
            "i2-2": "!= booking.ip_country",
            "o2-1": "50",
            "o2-2": "'Multiple bookings from different country'"
          },
          {
            "_id": "r2-2",
            "i2-1": "> 5",
            "i2-2": "",
            "o2-1": "30",
            "o2-2": "'Multiple rapid bookings'"
          },
          {
            "_id": "r2-3",
            "i2-1": "> 3",
            "i2-2": "!= booking.ip_country",
            "o2-1": "35",
            "o2-2": "'Several bookings from different country'"
          },
          {
            "_id": "r2-4",
            "i2-1": "> 3",
            "i2-2": "",
            "o2-1": "20",
            "o2-2": "'Several rapid bookings'"
          },
          {
            "_id": "r2-5",
            "i2-1": "",
            "i2-2": "!= booking.ip_country",
            "o2-1": "25",
            "o2-2": "'Booking from different country'"
          },
          {
            "_id": "r2-6",
            "i2-1": "",
            "i2-2": "",
            "o2-1": "0",
            "o2-2": "'Normal booking pattern'"
          }
        ],
        "inputs": [
          {
            "id": "i2-1",
            "name": "Recent Bookings 24h",
            "field": "account.bookings_last_24h"
          },
          {
            "id": "i2-2",
            "name": "Account Country",
            "field": "account.country"
          }
        ],
        "outputs": [
          {
            "id": "o2-1",
            "name": "Pattern Risk Score",
            "field": "risk.pattern.score"
          },
          {
            "id": "o2-2",
            "name": "Pattern Risk Reason",
            "field": "risk.pattern.reason"
          }
        ],
        "passThrough": true,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single",
        "passThorough": false
      },
      "id": "dt2",
      "name": "pattern_risk",
      "position": {
        "x": 430,
        "y": 114
      }
    },
    {
      "type": "decisionTableNode",
      "content": {
        "hitPolicy": "first",
        "rules": [
          {
            "_id": "r3-1",
            "i3-1": "< 30",
            "o3-1": "40",
            "o3-2": "'New account with significant transaction'"
          },
          {
            "_id": "r3-2",
            "i3-1": "< 90",
            "o3-1": "20",
            "o3-2": "'Relatively new account'"
          },
          {
            "_id": "r3-3",
            "i3-1": "> 1",
            "o3-1": "15",
            "o3-2": "'Previous chargeback history'"
          },
          {
            "_id": "r3-4",
            "i3-1": "",
            "o3-1": "0",
            "o3-2": "'Normal account history'"
          }
        ],
        "inputs": [
          {
            "id": "i3-1",
            "name": "Account Age (days)",
            "field": "account.age_days"
          }
        ],
        "outputs": [
          {
            "id": "o3-1",
            "name": "Account Risk Score",
            "field": "risk.account.score"
          },
          {
            "id": "o3-2",
            "name": "Account Risk Reason",
            "field": "risk.account.reason"
          }
        ],
        "passThrough": true,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single",
        "passThorough": false
      },
      "id": "dt3",
      "name": "account_risk",
      "position": {
        "x": 430,
        "y": 212
      }
    },
    {
      "type": "expressionNode",
      "content": {
        "expressions": [
          {
            "id": "e1-1",
            "key": "total_risk_score",
            "value": "sum(\n  map(values(risk), #.score)\n)"
          },
          {
            "id": "e1-5",
            "key": "risk_factors",
            "value": "map(\n  filter(values(risk), #.score > 0),\n  #.reason\n)"
          }
        ],
        "passThrough": true,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single"
      },
      "id": "ex1",
      "name": "risk_calculation",
      "position": {
        "x": 750,
        "y": 114
      }
    },
    {
      "type": "decisionTableNode",
      "content": {
        "hitPolicy": "first",
        "rules": [
          {
            "_id": "42dc5a6d-6605-40b6-83b4-bad0bcf445c6",
            "7385e66d-dc97-4048-a214-3f35d0029465": ">= 70",
            "35a4cafc-e27c-4419-bfd3-b89a3dcddf46": "\"high\""
          },
          {
            "_id": "c7910082-59fa-4aaf-b67e-5f807db68180",
            "7385e66d-dc97-4048-a214-3f35d0029465": ">= 30",
            "35a4cafc-e27c-4419-bfd3-b89a3dcddf46": "\"medium\""
          },
          {
            "_id": "cea70345-a575-4c72-a81d-b2808f1193ff",
            "7385e66d-dc97-4048-a214-3f35d0029465": "",
            "35a4cafc-e27c-4419-bfd3-b89a3dcddf46": "\"low\""
          }
        ],
        "inputs": [
          {
            "id": "7385e66d-dc97-4048-a214-3f35d0029465",
            "name": "Total risk score",
            "field": "total_risk_score"
          }
        ],
        "outputs": [
          {
            "id": "35a4cafc-e27c-4419-bfd3-b89a3dcddf46",
            "name": "Risk level",
            "field": "risk_level"
          }
        ],
        "passThrough": true,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single",
        "passThorough": false
      },
      "id": "9213dd68-a9f4-4b90-ada9-c7418d8b3c51",
      "name": "risk_level",
      "position": {
        "x": 1070,
        "y": 114
      }
    },
    {
      "type": "expressionNode",
      "content": {
        "expressions": [
          {
            "id": "d58ad60e-a542-4213-919d-66db853847ef",
            "key": "flags.requires_verification",
            "value": "risk_level in [\"medium\", \"high\"]"
          },
          {
            "id": "898fd37d-5370-4e9b-afa7-e04628805b29",
            "key": "flags.manual_review",
            "value": "risk_level == \"high\""
          }
        ],
        "passThrough": false,
        "inputField": null,
        "outputPath": null,
        "executionMode": "single"
      },
      "id": "e6dd7428-9ce6-4d8d-9a62-e38af18da14b",
      "name": "flags",
      "position": {
        "x": 1390,
        "y": 114
      }
    }
  ],
  "edges": [
    {
      "id": "ed1",
      "sourceId": "ip1",
      "targetId": "dt1",
      "type": "edge"
    },
    {
      "id": "ed2",
      "sourceId": "ip1",
      "targetId": "dt2",
      "type": "edge"
    },
    {
      "id": "ed3",
      "sourceId": "ip1",
      "targetId": "dt3",
      "type": "edge"
    },
    {
      "id": "ed4",
      "sourceId": "dt1",
      "targetId": "ex1",
      "type": "edge"
    },
    {
      "id": "ed5",
      "sourceId": "dt2",
      "targetId": "ex1",
      "type": "edge"
    },
    {
      "id": "ed6",
      "sourceId": "dt3",
      "targetId": "ex1",
      "type": "edge"
    },
    {
      "id": "018917a8-1af8-4de1-88e9-f7aa829006fc",
      "sourceId": "ex1",
      "type": "edge",
      "targetId": "9213dd68-a9f4-4b90-ada9-c7418d8b3c51"
    },
    {
      "id": "c627b3e0-ed4f-4701-a10c-668c84a96e70",
      "sourceId": "9213dd68-a9f4-4b90-ada9-c7418d8b3c51",
      "type": "edge",
      "targetId": "e6dd7428-9ce6-4d8d-9a62-e38af18da14b"
    }
  ]
}